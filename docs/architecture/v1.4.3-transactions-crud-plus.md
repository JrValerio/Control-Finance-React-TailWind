# Arquitetura v1.4.3 (Transactions CRUD+)

## Objetivo
Evoluir o CRUD de transacoes para um fluxo mais proximo de produto real:

- edicao de transacoes
- soft delete com desfazer real
- metadados de descricao e observacoes

## Banco de dados

- Migration `002_transactions_metadata_and_soft_delete.sql` adiciona:
  - `description TEXT NOT NULL DEFAULT ''`
  - `notes TEXT NOT NULL DEFAULT ''`
  - `deleted_at TIMESTAMPTZ NULL`

## API

- `GET /transactions` retorna apenas registros ativos (`deleted_at IS NULL`)
  - `?includeDeleted=true` inclui removidas
- `POST /transactions` aceita `description` e `notes`
- `PATCH /transactions/:id` atualiza campos de forma parcial
- `DELETE /transactions/:id` aplica soft delete (`deleted_at = NOW()`)
- `POST /transactions/:id/restore` restaura transacao removida

## Frontend

- Modal de transacao suporta criar e editar (`value`, `type`, `date`, `description`, `notes`)
- Lista exibe descricao e observacoes
- Exclusao com confirmacao
- Undo real por 10 segundos chamando endpoint de restore

## Testes

- API:
  - atualizacao por usuario
  - bloqueio de update/delete cross-user
  - soft delete + restore + listagem com/sem removidas
- Web:
  - criar
  - editar
  - excluir + desfazer
