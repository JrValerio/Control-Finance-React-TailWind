# Arquitetura v1.4.2 (Auth Hardening)

## Objetivo
Reduzir risco de brute-force no login sem impactar fluxo funcional existente.

## Estrategia

- Rate limit por IP em `POST /auth/login` com `express-rate-limit`.
- Bloqueio temporario por combinacao `IP+email` apos falhas consecutivas.
- Mensagem generica de bloqueio para evitar leak de informacao.

## Implementacao

- Middleware: `src/middlewares/login-protection.middleware.js`
  - `loginRateLimiter`
  - `bruteForceLoginGuard`
  - `registerLoginFailure`
  - `clearLoginFailures`
- Integracao em `src/routes/auth.routes.js`
  - pipeline: `loginRateLimiter -> bruteForceLoginGuard -> login handler`
  - falha `401` registra tentativa
  - sucesso limpa tentativas acumuladas

## Configuracoes por ambiente

- `AUTH_RATE_LIMIT_WINDOW_MS`
- `AUTH_RATE_LIMIT_MAX_REQUESTS`
- `AUTH_BRUTE_FORCE_WINDOW_MS`
- `AUTH_BRUTE_FORCE_MAX_ATTEMPTS`
- `AUTH_BRUTE_FORCE_LOCK_MS`
- `TRUST_PROXY` (recomendado `1` em deploy com proxy)

## Testes

- Bloqueio por brute force e desbloqueio apos janela.
- Isolamento por `IP+email` (bloqueio de um usuario nao afeta outro).
